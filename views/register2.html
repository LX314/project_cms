{% extends 'layout/layout.html' %}

{% block body %}
<form class="form-horizontal form-label-left" novalidate>
    <span class="section">注册</span>
    <div class="item form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="loginname">用户名:<span class="required">*</span></label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input id="loginname" class="form-control col-md-7 col-xs-12" data-validate-length-range="6" data-validate-words="2" name="loginname" placeholder="用户名" required="required" type="text">
        </div>
    </div>
    <div class="item form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="email">邮箱:<span class="required">*</span></label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="email" id="email" name="email" required="required" class="form-control col-md-7 col-xs-12" placeholder="邮箱" />
        </div>
    </div>
    <div class="item form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="email">确认邮箱:<span class="required">*</span></label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="email" id="email2" name="confirm_email" data-validate-linked="email" required="required" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="item form-group">
        <label for="password" class="control-label col-md-3">密码:<span class="required">*</span></label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input id="password" type="password" name="password" data-validate-length="6,8" class="form-control col-md-7 col-xs-12" required="required" placeholder="密码" />
        </div>
    </div>
    <div class="item form-group">
        <label for="passwordR" class="control-label col-md-3 col-sm-3 col-xs-12">确认密码:<span class="required">*</span></label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input id="passwordR" type="password" name="passwordR" data-validate-linked="password" class="form-control col-md-7 col-xs-12" required="required" placeholder="确认密码">
        </div>
    </div>
    <div class="item form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="telephone">电话:</label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="tel" id="telephone" name="phone" required="required" data-validate-length-range="8,20" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="item form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="textarea">个人介绍:</label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <textarea id="textarea" required="required" name="textarea" class="form-control col-md-7 col-xs-12"></textarea>
        </div>
    </div>
    <div class="item form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="usericon">用户头像</label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="file" name="avatar" id="avatar" accept=".jpg,.png" class="form-control col-md-7 col-xs-12" />
        </div>
    </div>
    <div class="ln_solid"></div>
    <div class="item form-group">
        <div class="col-md-6 col-md-offset-3">
            <button type="submit" class="btn btn-primary">重置</button>
            <button id="formSubmit" type="submit" class="btn btn-success">注册</button>
        </div>
    </div>
</form>

{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css" href="/css/validator.css" />
{% endblock %}

{% block js %}
<script type="text/javascript" src="/js/validator/validator.js"></script>
<script type="text/javascript" src="/js/bootstrap-progressbar/bootstrap-progressbar.js"></script>
<script type="text/javascript" src="/js/validator.js"></script>
<script>
$(function() {
    $('#formSubmit').on('click', function() {
        var msg  = '';
        var emailRE    = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/,
            nameRE     = /^([a-zA-Z0-9_-])+$/,
            phoneRE    = /^1(3|4|5|7|8)\d{9}$/,
            passwordRE = /^[A-Za-z0-9]{6,20}$/,     // 6-20位字母数字组合
            isLetter   = /[A-Za-z]+/,
            isNumber   = /[\d]+/;
        var name      = $('#loginname').val().trim(),
            email     = $('#email').val().trim(),
            password  = $('#password').val().trim(),
            passwordR = $('#passwordR').val().trim(),
            avatar    = $('#avatar')[0].files;
        if (!nameRE.test(name)) msg = '用户名不正确';
        if (!emailRE.test(email)) msg = '邮箱不正确';
        if (!passwordRE.test(password) || (!isLetter.test(password) || !isNumber.test(password))) msg = '密码格式不正确';
        if (password != passwordR) msg = '两次输入的密码不一致';
        // if (!avatar.length) msg = '请选择用户头像';
        var formData = new FormData();
        formData.append('loginname', name);
        formData.append('email', email);
        formData.append('password', password);
        formData.append('passwordR', passwordR);
        // formData.append('avatar', avatar[0]);
        if (msg) {
            alert(msg);
            return false;
        }
        $.ajax({
            url: '/reg',
            // data: formData,
            data: {
                loginname: name,
                email: email,
                password: password,
                passwordR: passwordR
            },
            type: 'post',
            // cache: false,
            // 告诉jQuery不要去处理发送的数据
            // processData: false,
            // 告诉jQuery不要去设置Content-Type请求头
            // contentType: false
        }).done(function(d) {
            console.log(d);
            alert(d.message);
            if (d.code === '0000') {
                location.href = '/';
            }
        }).error(function(e) {
            console.log(e)
        })
    });
});
</script>
{% endblock %}
